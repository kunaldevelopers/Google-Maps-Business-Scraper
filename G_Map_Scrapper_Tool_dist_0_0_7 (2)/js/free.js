var e=[],t={uiSettings:{},load:function(){setTimeout(function(){$(".start-free-trial-btn").click()},2e3),t.addEvents(),t.checkUserAuth()},checkUserAuth:async function(){chrome.storage.local.get(e=>{""!=e.key&&""!=e.token_id&&t.authUserToServer({},"sender",async function(e){e&&1==e.success&&1==e.data&&(t.uiSettings.authUser=!0,t.uiSettings.userFreeTrialStarted=!1,chrome.storage.local.set({userFreeTrialStarted:t.uiSettings.userFreeTrialStarted,authUser:t.uiSettings.authUser},function(e){location.href="index.html"}))})})},addEvents:function(){$(document).on("click",".start-free-trial-btn",async function(e){var a;e.preventDefault(),$(".loginResSection").hide(),a=await chrome.storage.local.get(),t.uiSettings=a,0==t.uiSettings.userTrialIsStarted?(t.uiSettings.userTrialIsStarted=!0,t.uiSettings.userFreeTrialStarted=!0,t.uiSettings.authUser=!0,chrome.storage.local.set({userTrialIsStarted:t.uiSettings.userTrialIsStarted,userFreeTrialStarted:t.uiSettings.userFreeTrialStarted,authUser:t.uiSettings.authUser},function(e){sendMessage({command:"productTrialStarted",reason:"manual"},function(e){}),Swal({type:"success",title:"Free Version activated!",title:'Your "Free Version" has been started',showCancelButton:!1,showConfirmButton:!0}),setTimeout(function(){location.href="index.html"},2e3)})):Swal({type:"warning",title:'Your "Free Version" already active',html:'<button class="btn btn-default btn-lg go-to-free-trial-btn">Go To Free Trial</button>',showCancelButton:!1,showConfirmButton:!0})}),$(document).on("click",".go-to-free-trial-btn",async function(e){e.preventDefault(),$(".loginResSection").hide();var a=await getSettings();t.uiSettings=a.uiSettings,t.uiSettings.userFreeTrialStarted=!0,t.uiSettings.authUser=!0,await chrome.storage.local.set({userTrialIsStarted:t.uiSettings.userTrialIsStarted,userFreeTrialStarted:t.uiSettings.userFreeTrialStarted,authUser:t.uiSettings.authUser}),sendMessage({command:"productTrialStarted",reason:"manual"},function(e){}),Swal({type:"success",title:"Free Trial Started!",html:'Your "Free Version" has been started',showCancelButton:!1,showConfirmButton:!0}),setTimeout(function(){location.href="index.html"},5e3)})},authUserToServer:function(e,t,a){chrome.storage.local.get(e=>{var t,r,n=new Headers;n.append("x-key",e.key),n.append("x-csrf-token",e.token_id),n.append("x-product-id","1"),n.append("Content-Type","application/x-www-form-urlencoded"),(t=new URLSearchParams).append("email",e.authName),r={method:"POST",headers:n,body:t,redirect:"follow"},fetch(consts.base_api_url+consts.auth_user_api_url,r).then(e=>e.json()).then(e=>a(e)).catch(e=>console.log("error",e))})}};function sendMessage(t,a){null!=a&&(e.push(a),t.callback="yes"),chrome.runtime.sendMessage(t,a)}function handleMessage(t,a){if(t.command,void 0!==t.data&&void 0!==t.callback&&"yes"==t.callback)e.pop()}function getSettings(e){return new Promise(async(e,t)=>{await chrome.storage.local.get(t=>{e({uiSettings:t})})})}window.addEventListener("load",function(){chrome.runtime.onMessage.addListener(handleMessage),t.load()});